clear();



//****** Get SSC directory ********
file_dir = env('SSCDIR')+'/tcsdata/typelib/MS_External_Power_Tower';
//*********************************

//Read in field layout
layout_file_loc = file_dir + '/tower_field_layout.csv';
f = open( layout_file_loc, 'r' );

if( !f )
{
	outln("Could not open file for reading");
	exit;
}

line = '';
hcount = 0;
while( read_line(f, line) )
{
	hcount = hcount + 1;
}

pos_array = alloc(hcount,2);

seek(f, 0, 0);
for(i=0; i<hcount; i=i+1)
{
	read_line(f, line);
	linedat = split(line, ",");
	xpos = linedat[0];
	ypos = linedat[1];
		
	pos_array[i][0] = xpos;
	pos_array[i][1] = ypos;
	
}

close(f);


field = add_unit("sam_mw_pt_heliostatfield");
weather = add_unit("weatherreader");

//Set weather parameters
wfile = "C:/SAM/2014.1.14/weather/CA Daggett.tm2";

set_value(weather, "file_name", wfile);
set_value(weather, "track_mode", 1);
set_value(weather, "tilt", 0);
set_value(weather, "azimuth", 0);


set_value(field, "run_type", 1);	//0=auto, 1=user-field, 2=user data
set_value(field, "helio_width", 12.);
set_value(field, "helio_height", 12.);
set_value(field, "helio_optical_error", 0.00153);
set_value(field, "helio_active_fraction", 0.97);
set_value(field, "helio_reflectance", 0.90);
set_value(field, "rec_absorptance", 0.94);
set_value(field, "rec_height", 5.);
set_value(field, "rec_aspect", 1);
set_value(field, "rec_hl_perm2", 0.);
set_value(field, "q_design", 25.);
set_value(field, "h_tower", 50);
set_value(field, "weather_file", wfile);
set_value(field, "land_bound_type", 0);
set_value(field, "land_max", 7.5);
set_value(field, "land_min", 0.75);
set_value(field, "p_start", 0.025);
set_value(field, "p_track", 0.055);
set_value(field, "hel_stow_deploy", 8);
set_value(field, "v_wind_max", 25.);
set_value(field, "n_flux_x", 10);
set_value(field, "n_flux_y", 1);
set_value(field, "helio_positions", pos_array);

connect(weather, "wspd", field, "vwind");
set_value(field, "field_control", 1.);
set_value(weather, "solzen", 90.);	//initialize to be on the horizon
connect(weather, "solzen", field, "solzen");
connect(weather, "solazi", field, "solaz");




simulate(1, 8760, 1, 30, false);
